{% extends "base.html" %}

{% block title %}Edit Post - Social Media Scheduler{% endblock %}

{% block content %}
<h2>‚úèÔ∏è Edit Post</h2>

<div class="form-card">
    <form method="POST" enctype="multipart/form-data">
        <!-- Post Title -->
        <div class="form-group">
            <label for="title">Post Title:</label>
            <input type="text" id="title" name="title" value="{{ post.title }}" required>
        </div>

        <!-- Post Content -->
        <div class="form-group">
            <label for="content">Post Content:</label>
            <textarea id="content" name="content" rows="5" required>{{ post.content }}</textarea>
        </div>

        <!-- Social Media Platform -->
        <div class="form-group">
            <label>Select Platform:</label>
            <div class="custom-select">
                <div class="select-selected">
                    {% if post.platform %}
                        <img src="{{ url_for('static', filename='logos/' + post.platform.lower() + '.png') }}" alt="{{ post.platform }}">
                        <span>{{ post.platform }}</span>
                    {% else %}
                        <span>Choose a platform</span>
                    {% endif %}
                </div>
                <div class="select-items">
                    <div data-value="Instagram"><img src="{{ url_for('static', filename='logos/instagram.png') }}" alt="Instagram"> Instagram</div>
                    <div data-value="Twitter"><img src="{{ url_for('static', filename='logos/twitter.png') }}" alt="Twitter"> Twitter</div>
                    <div data-value="Facebook"><img src="{{ url_for('static', filename='logos/facebook.png') }}" alt="Facebook"> Facebook</div>
                    <div data-value="LinkedIn"><img src="{{ url_for('static', filename='logos/linkedin.png') }}" alt="LinkedIn"> LinkedIn</div>
                </div>
                <input type="hidden" name="platform" value="{{ post.platform }}" required>
            </div>
        </div>

        <!-- Scheduled Time -->
        <div class="form-group">
            <label for="scheduled_time">Scheduled Time:</label>
            <input type="datetime-local" id="scheduled_time" name="scheduled_time" value="{{ post.scheduled_time.strftime('%Y-%m-%dT%H:%M') }}" required>
        </div>

        <!-- Existing Image Preview -->
        {% if post.image_filename %}
        <div class="form-group">
            <label>Current Image:</label>
            <img src="{{ url_for('uploaded_file', filename=post.image_filename) }}" class="post-image-preview">
        </div>
        {% endif %}

        <!-- Replace Image -->
        <div class="form-group">
            <label for="image">Replace Image (optional):</label>
            <input type="file" id="image" name="image" accept="image/*">
        </div>

        <!-- Submit & Cancel Buttons -->
        <div class="form-group form-buttons">
            <button type="submit" class="nav-btn submit-btn">üíæ Save Changes</button>
            <a href="{{ url_for('index') }}" class="action-btn cancel-btn">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<!-- Custom Dropdown JS -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const customSelect = document.querySelector(".custom-select");
    if (customSelect) {
        const selected = customSelect.querySelector(".select-selected");
        const items = customSelect.querySelector(".select-items");
        const hiddenInput = customSelect.querySelector("input[name='platform']");

        selected.addEventListener("click", () => {
            items.style.display = items.style.display === "flex" ? "none" : "flex";
        });

        items.querySelectorAll("div[data-value]").forEach(item => {
            item.addEventListener("click", () => {
                selected.innerHTML = item.innerHTML;
                hiddenInput.value = item.getAttribute("data-value");
                items.style.display = "none";
            });
        });

        document.addEventListener("click", function(e) {
            if (!customSelect.contains(e.target)) {
                items.style.display = "none";
            }
        });
    }
});
</script>
{% endblock %}
